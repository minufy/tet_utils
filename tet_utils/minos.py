I_OFFSETS = {
    "01": [[1, 0], [-2, 0], [-2, 1], [1, -2]],
    "10": [[-1, 0], [2, 0], [-1, 2], [2, -1]],
    "12": [[-1, 0], [2, 0], [-1, -2], [2, 1]],
    "21": [[-2, 0], [1, 0], [-2, -1], [1, 2]],
    "23": [[2, 0], [-1, 0], [2, -1], [-1, 2]],
    "32": [[1, 0], [-2, 0], [1, -2], [-2, 1]],
    "30": [[1, 0], [-2, 0], [1, 2], [-2, -1]],
    "03": [[-1, 0], [2, 0], [2, 1], [-1, -2]],
    "02": [[0, -1]],
    "13": [[1, 0]],
    "20": [[0, 1]],
    "31": [[-1, 0]],
}

JLTSZ_OFFSETS = {
    "01": [[-1, 0], [-1, -1], [0, 2], [-1, 2]],
    "10": [[1, 0], [1, 1], [0, -2], [1, -2]],
    "12": [[1, 0], [1, 1], [0, -2], [1, -2]],
    "21": [[-1, 0], [-1, -1], [0, 2], [-1, 2]],
    "23": [[1, 0], [1, -1], [0, 2], [1, 2]],
    "32": [[-1, 0], [-1, 1], [0, -2], [-1, -2]],
    "30": [[-1, 0], [-1, 1], [0, -2], [-1, -2]],
    "03": [[1, 0], [1, -1], [0, 2], [1, 2]],
    "02": [[0, -1], [1, -1], [-1, -1], [1, 0], [-1, 0]],
    "13": [[1, 0], [1, -2], [1, -1], [0, -2], [0, -1]],
    "20": [[0, 1], [-1, 1], [1, 1], [-1, 0], [1, 0]],
    "31": [[-1, 0], [-1, -2], [-1, -1], [0, -2], [0, -1]],
}

MINO_TYPES = ["Z", "L", "O", "S", "I", "J", "T"]
MINO_COLORS = {
    "I": "#42AFE1",
    "J": "#1165B5",
    "L": "#F38927",
    "O": "#F6D03C",
    "S": "#51B84D",
    "T": "#B94BC6",
    "Z": "#EB4F65",
    "X": "#555555",
    "H": "#444444",
}
MINO_SHAPES = {
    "I": {
        "0": (
            (0, 0, 0, 0),
            (1, 1, 1, 1),
            (0, 0, 0, 0),
            (0, 0, 0, 0),
        ),
        "1": (
            (0, 0, 1, 0),
            (0, 0, 1, 0),
            (0, 0, 1, 0),
            (0, 0, 1, 0),
        ),
        "2": (
            (0, 0, 0, 0),
            (0, 0, 0, 0),
            (1, 1, 1, 1),
            (0, 0, 0, 0),
        ),
        "3": (
            (0, 1, 0, 0),
            (0, 1, 0, 0),
            (0, 1, 0, 0),
            (0, 1, 0, 0),
        ),
    },
    "O": {
        "0": (
            (0, 1, 1, 0),
            (0, 1, 1, 0),
        ),
        "1": (
            (0, 1, 1, 0),
            (0, 1, 1, 0),
        ),
        "2": (
            (0, 1, 1, 0),
            (0, 1, 1, 0),
        ),
        "3": (
            (0, 1, 1, 0),
            (0, 1, 1, 0),
        ),
    },
    "T": {
        "0": (
            (0, 1, 0),
            (1, 1, 1),
            (0, 0, 0),
        ),
        "1": (
            (0, 1, 0),
            (0, 1, 1),
            (0, 1, 0),
        ),
        "2": (
            (0, 0, 0),
            (1, 1, 1),
            (0, 1, 0),
        ),
        "3": (
            (0, 1, 0),
            (1, 1, 0),
            (0, 1, 0),
        ),
    },
    "S": {
        "0": (
            (0, 1, 1),
            (1, 1, 0),
            (0, 0, 0),
        ),
        "1": (
            (0, 1, 0),
            (0, 1, 1),
            (0, 0, 1),
        ),
        "2": (
            (0, 0, 0),
            (0, 1, 1),
            (1, 1, 0),
        ),
        "3": (
            (1, 0, 0),
            (1, 1, 0),
            (0, 1, 0),
        ),
    },
    "Z": {
        "0": (
            (1, 1, 0),
            (0, 1, 1),
            (0, 0, 0),
        ),
        "1": (
            (0, 0, 1),
            (0, 1, 1),
            (0, 1, 0),
        ),
        "2": (
            (0, 0, 0),
            (1, 1, 0),
            (0, 1, 1),
        ),
        "3": (
            (0, 1, 0),
            (1, 1, 0),
            (1, 0, 0),
        ),
    },
    "J": {
        "0": (
            (1, 0, 0),
            (1, 1, 1),
            (0, 0, 0),
        ),
        "1": (
            (0, 1, 1),
            (0, 1, 0),
            (0, 1, 0),
        ),
        "2": (
            (0, 0, 0),
            (1, 1, 1),
            (0, 0, 1),
        ),
        "3": (
            (0, 1, 0),
            (0, 1, 0),
            (1, 1, 0),
        ),
    },
    "L": {
        "0": (
            (0, 0, 1),
            (1, 1, 1),
            (0, 0, 0),
        ),
        "1": (
            (0, 1, 0),
            (0, 1, 0),
            (0, 1, 1),
        ),
        "2": (
            (0, 0, 0),
            (1, 1, 1),
            (1, 0, 0),
        ),
        "3": (
            (1, 1, 0),
            (0, 1, 0),
            (0, 1, 0),
        ),
    },
}

class Mino:
    def __init__(self, type, x, y, rotation=0):
        self.type = type
        self.x = x
        self.y = y
        self.rotation = rotation

    def check_collison(self, board):
        for y, row in enumerate(MINO_SHAPES[self.type][str(self.rotation)]):
            for x, dot in enumerate(row):
                if dot:
                    if board.h > self.y+y >= 0 and board.w > self.x+x >= 0:
                        if board.grid[self.y+y][self.x+x] != " ":
                            return True
                    else:
                        return True
        return False

    def test_offsets(self, board, offsets):
        for x, y in offsets:
            if self.move(x, y, board):
                return True
        return False

    def rotate(self, r, board):
        if self.type == "O":
            return
        old_rotation = self.rotation
        self.rotation += r
        if self.rotation >= 4:
            self.rotation -= 4
        if self.rotation < 0:
            self.rotation += 4
        if self.check_collison(board):
            key = f"{old_rotation}{self.rotation}"
            offsets = JLTSZ_OFFSETS[key]
            if self.type == "I":
                offsets = I_OFFSETS[key]
            if self.test_offsets(board, offsets) == False:
                self.rotation = old_rotation

    def move(self, x, y, board):
        self.x += x
        self.y += y
        if self.check_collison(board):
            self.x -= x
            self.y -= y
            return False
        return True